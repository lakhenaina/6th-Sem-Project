<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order History | Cake's Bliss</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .order-container {
      max-width: 900px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }
    .order-item {
      border: 1px solid #ccc;
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 5px;
    }
    .order-item h3 {
      margin: 0;
      color: #c1121f;
    }
    .order-item p {
      margin: 4px 0;
    }
  </style>
</head>
<body>
  <div class="support-bar">
    Customer Support [Viber/WhatsApp: 9849647693]
  </div>

  <nav class="main-navbar">
    <div class="navbar-left">
      <a class="logo-link" href="customer-dashboard.html">
      <div class="logo">üç∞ Cake's Bliss</div>
      <ul class="nav-links">
        <li><a href="customer-dashboard.html">Dashboard</a></li>
        <li><a href="customer-about.html">About</a></li>
        <li><a href="customer-products.html">Products</a></li>
        
        <li><a href="customer-contact.html">Contact</a></li>
        <li><a href="customer-orders.html">My Orders</a></li>
      </ul>
    </div>
    <div class="navbar-right">
      <a href="cart.html" class="login-button">üõí Cart</a>
      <a href="login.html" class="login-button">Logout</a>
    </div>
  </nav>

  <div class="order-container">
    <h1>Your Orders</h1>
    <div id="ordersList"></div>
  </div>

  <script>
  
  const userId = localStorage.getItem("userId");
  if (!userId) {
    alert("Please log in to view your orders");
    window.location.href = "login.html";
  }

  async function loadOrders() {
    try {
      const res = await fetch(`http://localhost:3001/orders/${userId}`);
      const data = await res.json();
      const orders = data.data || [];
      const ordersList = document.getElementById("ordersList");

      if (orders.length === 0) {
        ordersList.innerHTML = "<p>You have no orders yet.</p>";
        return;
      }

      ordersList.innerHTML = orders.map(order => `
        <div class="order-item">
          <h3>Order ID: ${order._id}</h3>
          <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
          <p><strong>Payment:</strong> ${order.paymentMethod.toUpperCase()}</p>
          <ul>
            ${order.items.map(item => `
              <li>${item.product?.title || "N/A"} x ${item.quantity} - Rs. ${item.price * item.quantity}</li>
            `).join("")}
          </ul>
          <p><strong>Total:</strong> Rs. ${order.total}</p>
          <p><strong>Status:</strong> ${order.status}</p>
        </div>
      `).join("");
    } catch (err) {
      console.error(err);
      alert("Error loading orders.");
    }
  }

  loadOrders();
</script>


</body>
</html>
